## 1. 컴퓨터의 구조
* 운영체제란 무엇인가를 정의하기에 앞서 컴퓨터는 어떻게 이루어져 있는지 살펴보면 좋을 것 같다.

![image](https://user-images.githubusercontent.com/61929745/111281988-d86ead80-8680-11eb-9706-31ccb2c1b4f8.png)   
출처: https://dinfree.com/lecture/core/101_basic_1.html   

* CPU는 Central Processing Unit의 약자로, 중앙처리장치라고 한다. 컴퓨터 성능을 결정짓는 중요한 요소이고 실제로 컴퓨터 아키텍쳐 수업에서도 CPU의 Execution Time를 Performance의 지표로 삼기도 한다. 우리가 사용하고 있는 노트북의 i5, i7 등의 제품들이 CPU다.
* RAM은 CPU의 연산결과를 저장하고 처리할 수 있는 공간으로 프로그램 실행시 프로그램들이 메모리에 읽혀져 동작하게 된다. 따라서 RAM의 크기 역시 컴퓨터의 처리 속도를 결정짓는데 중요한 영향을 끼치리라고 예상할 수 있다. 메모리 용량이 클수록 여러 프로그램을 실행할 수 있고 높은 성능을 보장할 수 있다. 하지만 램은 전원이 꺼질 경우 내용이 지워지는 휘발성(Voltale) 메모리이기 때문에 영구적으로 저장해야 하는 데이터는 하드디스크 장치에 저장해야 한다.
* HDD(하드디스크)는 영구적으로 데이터를 저장하기 위한 장치이다. 우리가 컴퓨터를 껏다가 켜도 남아있는 내용들 예를 들어, 인터넷, 워드, 자바 Editor 같은 프로그램들은 하드디스크에 저장되어 관리되는 것이다. 최근에는 메모리 기반의 HDD인 SSD(Solid State Disk)의 가격이 저렴해지고 있어 많이 보급되고 있는데, 이를 통해 많은 양의 데이터를 저장해둘 수 있다.
* 메인보드는 쉽게 생각해서 하드웨어들을 꽂아두는 몸통이라고 생각할 수 있다.
* GPU는 컴퓨터에서 그래픽 처리를 전문적으로 하는 하드웨어다. 최근에는 GPU의 성능이 ML, DL의 학습에 있어 굉장히 중요한 요소가 되었기 때문에 GPU의 중요성이 커지고 있다.
---

## 2. 운영체제란?
* 운영체제는 OS라고 하며 하드웨어 장치를 유저가 사용할 수 있도록 환경을 제공하는 소프트웨어라고 볼 수 있다. 우리가 컴퓨터 속의 구조를 하나도 알지 못해도 클릭으로, 또는 커널의 명령으로 컴퓨터와 의사소통 할 수 있는 것이 운영체제가 있기 때문이다.
* **예를 들어, 우리가 짠 프로그램 코드를 돌린다고 가정해보자. 프로그램의 코드 중에서 컴퓨터 하드디스크 혹은 RAM에 저장되어 있는 어떤 정보를 read()하고, write()하는 작업이 있을 수 있다. 그렇다면 우리가 컴퓨터 코드로 짠 함수가 과연 어떻게 그 역할을 수행하는 것일까? 이 물음에 대한 답이 OS의 역할이라고 생각할 수 있다. 유저 코드에서 Read Call이 발생하면 해당 장치를 Handling하기 위해 User Mode에서 Kernel Mode로 바뀌게 되고, 그 곳에서 작업을 완료한 뒤 다시 User Mode로 돌아와 프로그램을 수행하는 것이다.**
  * 여기에서 한 가지 중요한 개념인 풀링에 대해 말해보고자 한다.
  * 풀링은 운영체제가 장치 사용을 감시하기 위해 동작여부를 수시로 체크하는 것을 말한다. 하지만 이러한 방식으로 매번 감시하는 것은 비효율적이기 때문에 장치에서 이벤트 발생 시 해당 이벤트를 통지해주는 Interrupt 개념이 사용된다. 
  * **다시 말해서, *Interrupt를 통해 User, Kernel Mode가 순환하는 것이다.* Interrupt의 종류에 대해 아래에서 자세히 알아보자.**
---

## 3.Dual mode operation과 OS의 역할
```
- Dual mode operation은 OS가 이상한 프로그램(Application faults)으로 인해서 잘못 동작하지 않도록 방지해주는 역할을 한다.
- Dual이라는 말처럼 OS는 User mode와 Kernel mode 두 가지 모드를 두는데, 핵심은 "언제 유저모드에서 커널 모드로 가는가?"이다.
- 그리고 이를 담당하는 것이 Interrupt의 역할이다.
- 특히, 특정한 machine instruction(privileged instruction)들은 무조건 커널 모드에서만 수행이 되어야 한다. 
- 유저 마음대로 OS의 작동을 좌지우지 할 수 있다면 너무 불안정할 수밖에 없다. 
- 대신에 유저는 적절한 System call을 통해서 OS에게 Kernel mode로 가서 요청한 작업을 해달라는 메시지를 보내야 한다. 아래 그림을 보자.
```
<img src = "https://user-images.githubusercontent.com/61929745/115344104-d223a200-a1e7-11eb-88c6-0619c1a32e6c.png" width = 500, height = 300>   

* 그림을 보면 OS는 Kernel mode에 가서 File System을 관리하고, I/O Management와 Memory Management 등을 수행한다. 또한 Hardware control을 통해 진짜 Hardware와 소통하게 된다.
* 따라서 우리는 적절한 System call을 실행해서 OS에게 Kernel모드로 가서 요청한 작업을 해달라고 할 줄 알아야 할 것이다. 아래에서 System call이 필요한 이유를 좀 더 살펴보자.

---
## 4-1. Interrupt?
* 인터럽트(Interrupt)란 CPU가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치나 프로그램 내 예외상황(Exception) 등이 발생하여 처리가 필요할 때 Processor에게 이를 알려주는 것을 말한다. 인터럽트에는 크게 HW, SW 인터럽트가 있고, System call 역시 이와 비슷한 역할을 수행하며 Processor에게 User Mode에서 Kernel Mode로 Handling할 것을 요구하게 된다.

![image](https://user-images.githubusercontent.com/61929745/111287174-4ff30b80-8686-11eb-9907-0a3f4fcb40ca.png)   
출처: http://www.it.uu.se/education/course/homepage/os/vt18/module-1/exception-and-interrupt-handling/ 
* Hardware Interrupt: 하드웨어가 발생시키는 인터럽트로, CPU가 아닌 다른 하드웨어 장치가 CPU에 어떤 사실을 알려주거나, CPU 서비스를 요청해야 할 경우 발생시킨다. 정전 또는 전원 공급의 이상, CPU 또는 기타 하드웨어의 오류 등이 있다.
* Software Interrupt(Exception): CPU 내부에서 실행되면서 인터럽트를 발생시키는 경우로써 프로그램 코드를 돌리는 과정에서 Exception이 발생할 때 Kernel Mode로 전환하여 에러를 핸들링하는 경우를 말한다. 예시로는 Divide by Zero, Overflow, Underflow 등이 있다.
* System Call: 사용자가 프로그램을 실행시키거나 OS를 호출하는 동작을 수행하는 경우에 일어난다. 모든 프로그램은 자신의 독자적인 주소 공간을 가지고 있으며, 프로그램이 함수를 호출하는 경우 자신의 주소 공간 내에서 호출이 이루어지게 된다. 그러나 System call은 비록 함수이지만 자신의 주소 공간이 아닌 Kernel 영역에 존재하는 함수를 호출하는 것이다. 
  * 특정 프로그램이 CPU를 독점하는 것을 방지하기 위해 CPU 할당 시간이 만료되면 인터럽트를 발생시켜 프로세스 처리를 분할하는 것도 System call의 역할이다.
  * System Call에는 파일 조작을 하는 생성, 삭제, 열기, 닫기, 읽고 쓰기부터 장치 관리, 정보 유지(time, date 등)과 통신을 하는 것 등이 있다.

#### System call의 장점
- 1. Easy to program : 유저가 hardware 부분의 내용까지 전부 몰라도 프로그래밍을 할 수 있게 해준다. 우리가 메모리를 읽고 쓰고 출력하는 것까지 다 코딩하려면 어떨까 상상해보면 된다.
- 2. Increasing system security : OS는 이상한 유저의 System call에 대해서는 kill을 해버려서 커널 모드에 진입할 수 없게 한다.
- 3. Increase program portability : 운영체제간 System call을 표준화함으로써 이식성을 강화할 수 있다.
---

## 4-2 인터럽트 처리 과정
* 인터럽트에 대한 처리 과정을 그림으로 살펴보면 아래와 같다. 
![image](https://user-images.githubusercontent.com/61929745/111311136-31e6d480-86a1-11eb-9cf4-63af127ee7b4.png)   
출처 : https://coding-factory.tistory.com/353   
1. 프로그램 실행을 중단한다.
2. 현재의 프로그램 상태를 보존한다.
3. 인터럽트 처리 루틴을 실행한다.
4. 인터럽트 서비스 루틴을 실행한다.
6. 인터럽트 요청 신호가 발생했을 때 보관한 PC의 값을 다시 PC에 저장한다.
7. PC의 값을 이용하여 인터럽트 발생 이전에 수행 중이던 프로그램을 계속 실행한다.   
  * 인터럽트 서비스 루틴(Interrupt service routine)이란, 인터럽트 핸들러라고도 하며 실제 인터럽트를 처리하는 루틴으로 실행 중이던 레지스터와 PC를 저장하여 실행중이던 CPU의 상태를 보존하고 인터럽트 처리가 끝나면 원래 상태로 복귀하는 것을 말한다. 운영체제 코드 부분에는 각종 인터럽트에 따라 처리해야 할 내용이 이미 프로그램화 되어 있다.
  * 보다 자세한 인터럽트 처리 방식은 여기서 다루지 않으려고 한다.
---

## 5. 운영체제의 구조
  ### 1) 단일 구조 운영체제(Monolithic)
   * 단일 구조 운영체제는 초기에 생겨난 가장 보편적인 형태로 운영체제의 모든 기능을 커널과 동일한 메모리 공간에 적재한 뒤, System Call을 통해 사용할 수 있다. 
   * 커널에는 파일 시스템, Processor 스케쥴링, 메모리 관리 등이 포함되며 시스템 호출을 하여 또 다른 운영체제 기능을 제공한다.
   * 단일 구조 운영체제는 대부분의 기능을 커널에 그룹화하여 구현하므로 속도가 빠르고 시스템 자원을 효율적으로 관리할 수 있다.
   * 하지만 커널 크기가 상대적으로 커지면서 버그의 원인이나 기타 오류를 구분하기 어렵고, 새 기능을 추가하는 수정과 유지보수가 어렵다.   
  ![image](https://user-images.githubusercontent.com/61929745/111312528-b8e87c80-86a2-11eb-922a-0477f335d8f9.png)   
  
  ### 2) 계층 구조 운영체제(Layering)
   * 계층 구조에서는 비슷한 기능을 수행하는 요소를 *그룹화*하여 계층적으로 구성한다. 실제르 프로세스 요청을 수행할 때 0계층부터 5계층까지 거쳐야 한다. 이때 각 계층은 서로 인접한 계층과 상호작용하며, 각 계층은 자신의 하위 계층만 서비스한다.
   * 모듈화가 잘 되어 있어 유지보수가 편하지만, 계층 구조를 정의하기 어렵기 때문에 결론적으로 성공한 모델이 아니다.   
  ![image](https://user-images.githubusercontent.com/61929745/111312830-06fd8000-86a3-11eb-80d2-419cc497b940.png)   

  ### 3) 마이크로커널 구조 운영체제(Microkernel)
```
- 단일 구조, 계층 구조 운영체제와 같이 한 개의 커널을 사용하는 운영체제의 관리 어려움 때문에 커널이 모듈화된 구조이다.
- 커널에는 최소 기능만 포함시켜 크기를 줄이고, 기타 기능은 사용자 공간으로 옮겨 사용자 영역에서 수행하도록 한 것이다.
- 커널이 가벼워져 잘못된 수행이 있더라도 커널에 치명적인 영향을 미칠 확률이 줄어들고, 모듈화 개념을 적용했기 때문에 이식성이 좋고 규모 확장성이 뛰어나다. 
- 하지만 무엇보다 모듈간에 통신(커널-커널)이 빈번하게 발생될 때, 성능이 떨어지는 문제점이 있다.   
```
![image](https://user-images.githubusercontent.com/61929745/111313143-56dc4700-86a3-11eb-9dde-df8773cdd585.png)   
   * 출처: https://wonit.tistory.com/80
---


## 6. 마치면서
* 컴퓨터 구조에 대한 기본적인 이해와 운영체제란 무엇인가에 대해 살펴봤다. 그리고 운영체제의 구조와 User, Kernel Mode를 전환하는 Interrupt 방식에 대해 살펴보았다. 특히 Dual mode는 OS의 가장 핵심적인 부분으로 정확히 이해해야 할 것 같다. 
